<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Calculator</title>
	<style>
		table {width: 361px;height: 581px;border: 1px solid;text-align: center;border-collapse: collapse;background-color: #e1e1e1;font-weight: 700;font-size: 25px;table-layout: fixed;}
		.mathematical-expression {height: 40px;padding-top: 10px;padding-left: 110px;font-size: 16px}
		.result {height: 90px;font-size: 50px;word-break:break-all;}
		table td {border: 1px solid #a9a9a9; border-width: 0 0 1px 1px;padding: 0}
		button {display: block;width:100%;height: 100%;border: 0; background: 0;font-weight: inherit;color: inherit;font-size:inherit;padding: 0;}
		tbody td:last-child {background-color: #f5933c;color: #fff;font-weight: 300;font-size: 40px}
		tbody tr:first-child {background-color: #d4d4d4;}
		tbody td[colspan] button {text-align: left; padding-left: 37px;}
		thead {background-color: #4b4b4b;text-align: right;}
		thead td {padding-right: 30px;color: #fff;}
		thead tr:first-child td{border-bottom: 0;}
		.mathematical-expression {background: url(../img/img.png) no-repeat 10px 10px;}
	</style>
</head>
<body>
	<table>
		<colgroup>
			<col style="width: 25%">
			<col style="width: 25%">
			<col style="width: 25%">
			<col>
		</colgroup>
		<thead>
			<tr>
				<td class="mathematical-expression" colspan="4" data-output="expression"></td>
			</tr>
			<tr>
				<td class="result" colspan="4" data-output="result"></td>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><button type="button" data-btn="reset">C</button></td>
				<td><button type="button" data-symbol="plusMinus">+/-</button></td>
				<td><button type="button" data-symbol="percent">％</button></td>
				<td><button type="button" data-operator="division">÷</button></td>
			</tr>
			<tr>
				<td><button type="button" data-number="7">7</button></td>
				<td><button type="button" data-number="8">8</button></td>
				<td><button type="button" data-number="9">9</button></td>
				<td><button type="button" data-operator="times">×</button></td>
			</tr>
			<tr>
				<td><button type="button" data-number="4">4</button></td>
				<td><button type="button" data-number="5">5</button></td>
				<td><button type="button" data-number="6">6</button></td>
				<td><button type="button" data-operator="minus">-</button></td>
			</tr>
			<tr>
				<td><button type="button" data-number="1">1</button></td>
				<td><button type="button" data-number="2">2</button></td>
				<td><button type="button" data-number="3">3</button></td>
				<td><button type="button" data-operator="plus">+</button></td>
			</tr>
			<tr>
				<td colspan="2"><button type="button" data-number="zero">0</button></td>
				<td><button type="button" data-symbol="dot">.</button></td>
				<td><button type="button" data-btn="calculate">=</button></td>
			</tr>
		</tbody>
  </table>
<script>
const Calculator = {
  acc: 0,
  input: '',
  expr: '',
  lastOperand: 0,
  lastOperator: '',
  el: {
    input: [
      ...document.querySelectorAll('[data-number]'),
      document.querySelector('[data-symbol=dot]'),
      document.querySelector('[data-symbol=plusMinus]')
    ],
    operator: [...document.querySelectorAll('[data-operator]')],
    calculate: document.querySelector('[data-btn=calculate]'),
    reset: document.querySelector('[data-btn=reset]'),
    screen: document.querySelector('[data-output=result]'),
    exprScreen: document.querySelector('[data-output=expression]'),
  },

  display(){
    const {screen,exprScreen} = this.el;
    screen.textContent = this.input ? `i ${this.input}` : `a ${this.acc}`;
    exprScreen.textContent = this.expr;
  },

  inputHandler(e){
    const value = e.target.textContent;
    switch(value){
      case '.':
        if(this.input.includes('.')) return;
        this.input = !this.input ? '0.' : this.input + '.';
      break;
      case '+/-':
        if(!this.input) return;
        this.input = (parseFloat(this.input) * -1).toString();
      break;
      case '0':
        // 처음 0 누를 때
        if(!this.input) return;
      default: // 0~9
        this.input += value;
    }
    this.display();
  },

  calc(operator, operand){
    if(!operator || !operand) return;
    switch(operator){
      case '+': return this.acc + operand;
      case '-': return this.acc - operand;
      case '×': return this.acc * operand;
      case '÷': return this.acc / operand;
      default: return null;
    }
  },

  operatorHandler(e){    
    const operand = parseFloat(this.input);
    const operator = e.target.textContent;
    
    if(!this.lastOperator && !operand) return; // 첫 연산에서 입력 없이 기호를 누른 경우 바로 return
    
    if(this.lastOperator && !operand) {
    // 입력 값은 없지만, 직전 연산 기호가 있을 때: 연산 기호를 연달아 누른 경우 expr 수정
      this.expr = this.expr.slice(0,-3);
      this.expr += ` ${operator} `;
    } else {
      this.acc = this.lastOperator
        ? this.calc(this.lastOperator, operand) // 주의, 연산은 기호 누른 다음에 피 연산자를 필요로 하기 때문에 지금 누른 기호는 항상 다음 기호 누를 때 동작한다.
        : operand; // 첫 연산일 때, 입력 값을 바로 누적 값으로 저장(피 연산자가 없기 때문에 연산과정 필요 x)
      
      this.expr += `${operand} ${operator} `;
      this.lastOperand = operand;
    }

    this.lastOperator = operator; // 직전 연산 기호 갱신
    this.input = '';
    this.display();
  },

  clearHandler(){
    this.acc = 0;
    this.input = '';
    this.expr = '';
    this.lastOperator = '';
    this.lastOperand = 0;
    this.display();
  },

  calcHandler(){

  },

  addEvents(){
    const {input,operator,calculate,reset} = this.el;
    input.forEach(button => button.addEventListener('click', e => this.inputHandler(e)));
    operator.forEach(button => button.addEventListener('click', e => this.operatorHandler(e)));
    calculate.addEventListener('click', () => this.calcHandler());
    reset.addEventListener('click', () => this.clearHandler());
  },

  init(){
    this.addEvents();
    this.clearHandler()
  }
};
Calculator.init();
</script>
</body>
</html>